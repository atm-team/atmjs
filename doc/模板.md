# 模板
* atmjs系统采用的是[nunjucks模板引擎](http://mozilla.github.io/nunjucks/),支持模板引入，模板继承，宏，过滤器等功能
* 模板文件应位于模块包的html目录或其子目录下
* 访问方式：

 ```
 文件位置: /html/xxx.html
 访问路径: (http://127.0.0.1:2015)/files/{{siteName}}/{{project}}/{{module}}/{{version}}/html/xxx.html

 文件位置: /html/pathto/xxx.html
 访问路径: (http://127.0.0.1:2015)/files/{{siteName}}/{{project}}/{{module}}/{{version}}/html/pathto/xxx.html
 ```

## 模板引入 `include`

>include 可引入其他的模板，可以在多模板之间共享一些小模板,这一点可以帮助我们把模板切分成更小的部分，从而使得需要改变页面的公共部分时，只需修改公共模板，而非所有的模板

```
{% include path/to/xxx.html %}
```

## 模板函数及模板变量
#### atmjs.use()
```js
// 声明页面的入口脚本,需要写在atmjs.loadCss和atmjs.loadJs的前面
// 如果参数为空类型,则自动指向到src下与当前模块同名的js类型文件
// 如果参数以冒号开头,则后面的fileId就会去当前模板所在的模块下的src目录下去寻找
{{ atmjs.use() }}
{{ atmjs.use(':fileId') }}
{{ atmjs.use('namespace:fileId') }}
```


#### atmjs.loadCss()

```js
// 生成入口文件依赖的全部的css标签
{{ atmjs.loadCss() }}
```

#### atmjs.loadJs()

```js
// 生成入口文件依赖的全部的javascript标签
{{ atmjs.loadJs() }}
```

#### atmjs.id
```
eg1:
{{ atmjs.use('namespace:fileId') }}
<script type="text/javascript">
    atmjs.use('{{ atmjs.id }}', function () { /* use单个文件时需要引号 */ });
</script>

eg2:
{{ atmjs.use(['namespace:fileId1', 'namespace:fileId2') }}
<script type="text/javascript">
    atmjs.use({{ atmjs.id }}, function () { /* use多个文件时不需要引号 */ });
</script>
```

## 过滤器
* 过滤器是一些可以执行变量的函数，通过管道操作符 (|) 调用，并可接受参数。
* 在atmjs的模板里，除了支持[nunjucks内置的过滤器](http://mozilla.github.io/nunjucks/cn/templating.html#builtin-filters)，另外增加了path和uri两个过滤器

#### path过滤器
>把相对于模块包目录的文件路径，转换成模板文件的绝对路径。

```js
当前文件:user/account/1.0.0模块下的xxx.html
^_^ 引入当前模块下的html/yyy.html文件,可以通过相对路径,也可以通过path过滤器
相对路径法：
{% include './yyy.html' %}
path过滤器法：
{% include 'html/yyy.html' | path %}

^_^ 跨模块引入user/common/1.0.0模块下的yyy.html，只能用path过滤器法,版本号可有可无:
{% include 'html/yyy.html' | path('user/common') %} 或
{% include 'html/yyy.html' | path('user/common/1.0.0') %}
```

#### uri过滤器
* 把相对于模块包目录的文件路径，转换成atmjs环境中模板的http[s]访问地址。
* uri过滤器支持指定模块和jsonp及timeout配置

```js
当前文件:user/account/1.0.0模块下的xxx.html
^_^ 与当前模块下的html/yyy.json文件通信,可以通过相对地址,也可以通过uri过滤器
相对地址法：
<a href="./yyy.html">yyy.json</a>
uri过滤器法：
<a href="{{ 'html/yyy.json' | uri }}">yyy.json</a>

^_^ 跨模块与user/common/1.0.0模块下的yyy.json文件通信，可以用uri过滤器法,版本号可有可无:
<a href="{{ 'html/yyy.json' | uri('user/common') }}">yyy.json</a>

^_^ jsonp及timeout设置
<a href="{{ 'html/yyy.json' | uri({timeout: 2000}) }}">yyy.json</a>
<a href="{{ 'html/yyy.json' | uri('user/common', {timeout: 3000, jsonp: true, otherQuery: 'xxx'}) }}">yyy.json</a>

^_^ 在浏览器中通过查看模板的源代码可以看到，上面的写法都会被转换成文件在atmjs中的访问路径，格式如下:
/files/{{siteName}}/{{project}}/{{module}}/{{version}}/html/xxx.xxx[?timeout=xxx[&callback=xxx][&other=xxx]]

```
